# TSIRBUNEN POTTERY ADMIN

This is the "admin control panel" to enable easy managing of Tsirbunen Pottery products for **[TSIRBUNEN POTTERY webpages](https://tsirbunen-pottery.netlify.app)**.
NOTE: Currently this app is to be run ony locally.

### GraphQL-related code and Typescript type generation

Some GraphQL-related code relies on **[code generation using @graphql-codegen/cli](https://the-guild.dev/graphql/codegen/docs/getting-started)**. The way code generation is set up in this project is this:

- Different features or entities are arranged into modules in the **[/modules](/app/api/graphql/graphql-server/modules/)** folder in the api code.
- The source of the GraphQL schema are the **schema.graphql**-files in folders in the modules folder.
- The code generator is configured in the **[graphql-codegen.yml file](./graphql-codegen.yml)**.
- In server code generation, the **[Yoga server preset](https://the-guild.dev/graphql/codegen/docs/guides/graphql-server-apollo-yoga-with-server-preset)** is capable of using the schema.graphql files as input and producing typeDef, resolver and Typescript type ts-files as output.
- In client side code generation, the necessary Document objects and Variable and Query types are created into a file within the same folder as the \*.graphql files.

Whenever making changes to schema, code update is needed and this can be performed by running
&nbsp;&nbsp;&nbsp;&nbsp; **`npm run generate:types`**
NOTE: You might need to delete autogenerated type-files before that!

### Libraries and packages

- Api graphQL server: the easy-to-set-up **[Graphql Yoga](https://the-guild.dev/graphql/yoga-server/docs)**
- Automatic code generation: **[@graphql-codegen/cli (with a preset and plugins)](https://the-guild.dev/graphql/codegen/docs/getting-started)** GraphQL Yoga with server preset for server and near-operation file generation for Apollo client
- UI Component library: **[Chakra ui](https://chakra-ui.com)**
- **[React Compiler](https://react.dev/learn/react-compiler)** is used to reduce the need for manual optimizations like useMemo and useCallback and the **[eslint-plugin-react-hooks](https://www.npmjs.com/package/eslint-plugin-react-hooks)** is used to catch incorrect or unsafe usage of React Hooks.

### Codebase overall structure

The structure of the project is very much **dictated by the selected Next.js framework**. The main structure is provided in the skeleton below, followed by a table with some descriptions.

```
tsirbunenpottery_admin/
    ├── app/
        ├── api/
            └── graphql/...
                ├── graphql-server/...
                └── route.ts
        ...
        ├── layout.tsx
        └── page.tsx
    ├── ui/
        ├── api-service/...
        ├── pages/...
        └── components/...


```

| Folder / file            | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| :----------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **app/**                 | Due to selecting the **Next.js framework** with the App Router, all the routes need to be defined in the app folder as sub-folders that (1) are named according to the route they serve and (2) contain a file named **page.tsx** with the page content (for example, for route "home/" there is app/home/page.tsx). The page.tsx files only contain "wrappers" that return the actual (dynamically loaded) components that have their code in ui/pages folder |
| **app**/layout.tsx       | Top level layout element (required by Next.js; needed to modify HTML on initial load). All common providers are introduced here to be available to application throughout                                                                                                                                                                                                                                                                                      |
| **app**/page.tsx         | The launch page of the application (the default starting route "/" required by Next.js)                                                                                                                                                                                                                                                                                                                                                                        |
| **app/api/**             | The "internal" Next api is contained as an app route in the app folder (required byt Next.js)                                                                                                                                                                                                                                                                                                                                                                  |
| **app/api/graphql/**     | The graphql-server () is in api route graphql. In this project, the handler (in file route.ts) returns a Yoga request handler.                                                                                                                                                                                                                                                                                                                                 |
| **app-business-domain/** | Business logic, types and interfaces that all others must conform to.                                                                                                                                                                                                                                                                                                                                                                                          |
| **app-datastore/**       | All database configurations and connections to the database.                                                                                                                                                                                                                                                                                                                                                                                                   |
| **app-ui/**              | The actual client code.                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **\_\_tests\_\_**        | These folders (that are scattered around) contain test files that test the code nearby.                                                                                                                                                                                                                                                                                                                                                                        |
